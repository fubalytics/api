<html>
<body>

<script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<!-- set the patch according to your system! -->
<script src="../js/fubalytics.js"></script>




<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />


<h1>Tests</h1>


<script type="text/javascript">

/**
EDIT_HERE: apply here your custom exception handling routine!
if this is called, that means, that the process cannot operate further and 
it has been cancelld 
**/
function handle_exception(e){
	
	alert(e);

}



	
/**
EDIT_HERE:
Fill this function according to your needs.
it must return a list of players.
Something similar to:
var players=[{firstname:"Mario", lastname:"Gomez", birthdate:null, arb_token:"{e2c_player_id:23}"}, 
{firstname:"Lukas", lastname:"Podolski", birthdate:123456789, arb_token:"{e2c_player_id:24}"}]};
-------------
== WARNING!
-------------
Please make sure, that you submit the arbitrary token!
If you dont, no error will occur. But you will not be able to map
your players in the fubalytics system ever again!
**/
function get_all_players_for_test(){
	var players=[{firstname:"Mario", lastname:"Gomez", birthdate:null, arb_token:"{e2c_id:23}"}, 
		{firstname:"Lukas", lastname:"Podolski", birthdate:123456789, arb_token:"{e2c_id:24}"}];
	return players;
}

fubalytics.auth_token="JunHbEJhUgjFjqiiaauC"; //this might change frequently. Please check your settings
fubalytics.fubalytics_url="http://demo.fubalytics.net:3000"; //use here only a testing server please!!!!!!
var internal_user_data={
	id:1, 
	email:"holger"+Math.round(Math.random(4)*1e4)+"@gmx.de", 
	firstname:"holger", 
	lastname:"Wittke", 
	language:"de",
	club_name:"FC Hadoken 2013"
};

//----------
//get the internal club_id of a club from the fubalytics system
//----------
try {
	var club_id=fubalytics.get_or_create_club(internal_user_data.club_name);
	console.log("The club "+internal_user_data.club_name+" has the id %i in fubalytics", club_id);
}catch(e){
	handle_exception(e);
	return;
}



//-------------
//	get the available team ranks 
//--------------
var team_ranks=fubalytics.get_team_ranks();
console.log("#TEAM RANKS#: %o", team_ranks);

//--------------
//	get the available team types 
//--------------
var team_types=fubalytics.get_team_types();
console.log("#TEAM TYPES#: %o", team_types);


//-------------
// 	creating a user in fubalytics
//-------------
try {
	var new_user_id=fubalytics.setup_new_user({
		club_id: club_id,
		internal_user_id: internal_user_data.id, //the user ID of THIS user
		email: internal_user_data.email,
		firstname: internal_user_data.firstname,
		lastname: internal_user_data.lastname,
		language: internal_user_data.language});
	console.log("User created: "+new_user_id);
	// submit all the players
	//define the input first
	var players_batch_input={
		team_type_id:team_types[0].team_type.id, 
		team_rank_id:team_ranks[0].team_rank.id, 
		club_id:club_id, 
		fubalytics_user_id:new_user_id, 
		players:get_all_players_for_test()};
	//call the api method
	fubalytics.create_players(players_batch_input);
}catch(e){
	handle_exception(e);
	return;
}


//------------------
//getting the object for the player stored here (in e2c) with the ID 23
//------------------
var player=fubalytics.find_player_by_arb_token("{e2c_id:23}")[0].player;
console.log("player found: %o", player);

console.log("updating player");
fubalytics.update_player({id:player.id, gender:"w", firstname:"updated_firstname", lastname:"updated_lastname"});
//check if the update was successful
console.log("checking player update");
player=fubalytics.find_player_by_arb_token("{e2c_id:23}")[0];
if (player.player.firstname!="updated_firstname"){
	console.error("The player update was not successful!")
}
//-------destroy the player
fubalytics.delete_player(player.player.id);
//check if deleting was successful
players=fubalytics.find_player_by_arb_token("{e2c_id:23}");
console.log("found players:");
console.log(players);
if (players.length>0){
	console.error("The player deletion was not successful!")
}

//----------------
//	testing the recording update
//----------------
var recordings=fubalytics.find_recording_by_arb_token("e2c_id:11")
if (!recordings)
{
	console.error("Could not find any recording with e2c_id:11");
}
console.log("found recording: %o", recordings);
inp={id:recordings[0].recording.id, 
	team_1:{
		team_rank_id:1, 
		team_type_id: 1,
		club_id:1},
	team_2:{
		team_rank_id:2, 
		team_type_id:1, 
		club_id:2},
	title:"test",
	description:"test description",
	start_time:"11.12.2011 10:20",
	score_team_1:1,
	score_team_2:0,
	event_type_id: 1
};

var new_rec=fubalytics.update_recording(inp);
if (!new_rec){
	console.error("Could not update the recording");
}
console.log("After updating the recording: %o", new_rec);

//-----------------
//	creating and deleting a new recording
//-----------------
var inp2={ 
	team_1:{
		team_rank_id:1, 
		team_type_id: 1,
		club_id:1},
	team_2:{
		team_rank_id:2, 
		team_type_id:1, 
		club_id:2},
	title:"test",
	description:"test description",
	start_time:"11.12.2011 10:20",
	score_team_1:1,
	score_team_2:0,
	event_type_id: 4,
	arb_token:"{e2c_id:12}"
};

new_rec=fubalytics.create_recording(inp2);
console.log("create a new recording: %o", new_rec);

//now delete it
fubalytics.delete_recording({id:new_rec.recording.id});


</script>

</body>
</html>
